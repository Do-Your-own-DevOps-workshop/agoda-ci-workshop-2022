on:
  pull_request:
    branches:[main]

jobs:
  build_and_push:
    runs-on: ubuntu-latest
    steps:
          uses: actions/checkout@v3
          uses: docker/login-action@v2
               with:
                  username: ${{ secrets.DOCKERHUB_USER }}
                  password: ${{ secrets.DOCKERHUB_TOKEN }}
          uses: docker/build-push-action@v3
          with:
          push: true
                tags: |
                       encx/agoda-ci-workshop-2022:1.0.${{ github.run_id }}-alpha
  Test:
     needs: build_and_push
     has: 
        services:
           our_website:
                image: encx/agoda-ci-workshop-2022:1.0.${{ github.run_id }}-alpha
                ports:
                    - 3000:3000
        runs-on: ubuntu-latest
        steps:
              uses: actions/setup-node@v3
              with:
              node-version: 16.x
              uses: actions/checkout@v3
              run: yarn
              run: npx playwright install chromium
              
